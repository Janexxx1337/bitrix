window.addEventListener('DOMContentLoaded', ()=> {
    const pars = document.querySelector('#nik_string-params').dataset.params;
    const correctPars = JSON.parse(pars);
    const currentURL = window.location.href;
    const regex = /\/crm\/deal\/details\/\d+\//;

    BX.onCustomEvent = function(handler){
        if (handler === 'crmEntityIframeLoad' && correctPars.switch_on === "Y") {
            const iframe = document.querySelector('.side-panel-iframe');
            const title = iframe.contentWindow.document.getElementById('pagetitle');

            if (!title.innerText.includes(correctPars.text)) { // Проверяем, что текст еще не был добавлен
                title.prepend(correctPars.text);
            }

        } else if (regex.test(currentURL) && correctPars.switch_on === "Y" ) {
            const descTitle = document.querySelector('.crm-pagetitle');

            if (!descTitle.innerText.includes(correctPars.text)) { // Проверяем, что текст еще не был добавлен
                descTitle.prepend(correctPars.text);
            }

        }
    }
});
